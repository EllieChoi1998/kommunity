<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>해시태그 입력 및 검색</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
<div th:fragment="rightSidebarFragment">
    <div class="mt-3"></div> <!-- 상단 여백 추가 -->
    <div class="input-group mb-3 inp_tag">
        <div id="hashtags-container" class="hashtags-container">
            <input type="text" id="hashtags" class="form-control hashtag-input" placeholder="태그입력"
                   aria-label="Search" aria-describedby="search-addon"/>
        </div>
        <button type="button" class="btn btn-outline-primary" id="search-btn">검색</button>
    </div>
    <input type="hidden" id="hashtags-hidden" name="hashtags">

    <!-- 주석 처리된 부분 -->
    <!--
    <div class="mt-3">
        <button id="newBtn" class="btn btn-outline-primary mb-2">New Board</button>
        <select id="search_type" class="form-select mb-2">
            <option value="title">제목</option>
            <option value="content">내용</option>
            <option value="hashtag">해쉬태그</option>
        </select>
        <input type="text" title="태그" name="tagText" id="tagText" placeholder="태그" class="form-control rounded" value="">
        <button type="button" class="btn btn-outline-primary" id="search-tag-btn">태그 검색</button>
    </div>
    -->

    <!-- 채팅기능 -->
    <div th:replace="~{chat :: chatFragment}"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const hashtagsInput = document.getElementById("hashtags");
        const hashtagsContainer = document.getElementById("hashtags-container");
        const hiddenHashtagsInput = document.getElementById("hashtags-hidden");

        let hashtags = [];

        function addHashtag(tag) {
            tag = tag.replace(/[\[\]]/g, '').trim();
            if(tag && !hashtags.includes(tag)) {
                const span = document.createElement("span");
                span.innerText = "#" + tag;
                span.classList.add("hashtag");

                const removeButton = document.createElement("button");
                removeButton.innerText = "x";
                removeButton.classList.add("remove-button");
                removeButton.addEventListener("click", () => {
                    hashtagsContainer.removeChild(span);
                    hashtags = hashtags.filter((hashtag) => hashtag !== tag);
                    hiddenHashtagsInput.value = hashtags.join(",");
                    hashtagsInput.value = hashtags.join(","); // Update input value
                });

                span.appendChild(removeButton);
                hashtagsContainer.insertBefore(span, hashtagsInput);
                hashtags.push(tag);
                hiddenHashtagsInput.value = hashtags.join(",");
                hashtagsInput.value = hashtags.join(","); // Update input value
            }
        }

        hashtagsInput.addEventListener("keydown", (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                const tag = hashtagsInput.value.trim().replace(/^#+/, ''); // Remove leading #
                if (tag) {
                    addHashtag(tag);
                    hashtagsInput.value = "";
                }
            }
        });

        hashtagsInput.addEventListener("input", function() {
            if (!hashtagsInput.value.startsWith('#')) {
                hashtagsInput.value = '#' + hashtagsInput.value;
            }
        });

        hashtagsInput.addEventListener("focus", function() {
            if (!hashtagsInput.value.startsWith('#')) {
                hashtagsInput.value = '#' + hashtagsInput.value;
            }
        });
    });
</script>
</body>
</html>
